# 愿景
为了让接入国际化成为轻松且愉快的事😄💪🏻

# 原理

该库主要由两部分构成
* 命令行工具
* 函数 API

**命令行工具**：根据指定规则解析出需要翻译的文本片段，并通过翻译平台将文本片段翻译到指定目标语言，最后生成语言包文件

解析文本片段的匹配规则如下
```js
// 普通字符串
i18n('xxx')
i18n("xxx")
i18n(`xxx`)
// 支持动态参数
i18n('xxx{0}xxx', param1)
i18n('xxx{0}xxx{1}xxx{2}xxx', param1, param2, param3)
```
**函数 API**：将国际化语言包接入到项目中，由 `setI18N` 和 `i18n` 构成

* **setI18N**：设置语言和语言包
* **i18n**：用于包裹被翻译文本实现国际化，也作为命令行匹配翻译文本规则的标识

所以 `命令行工具` 和 `函数 API` 这两者搭配使用效果更佳，也正是由于这样的结构设计，使得 `i181n-pro` 库可以很方便集成到任何的 `JavaScript` 项目中

# 用法
## 1. 安装
```bash
npm i i18n-pro
# 或者
yarn add i18n-pro
# 或者
pnpm i i18n-pro
```
## 2. 接入函数 API
📢📢📢：这一步主要是用 `i18n` 函数包裹需要被翻译的文本
### 挂载全局对象的形式
#### 引用函数
```js
import { setI18N, i18n } from 'i18n-pro'

// 需要在应用页面渲染逻辑之前
// 浏览器环境，注意：如果是Node环境需要将window替换成global
window.setI18N = setI18N
window.i18n = i18n
// 后续才是应用的页面渲染逻辑
```
#### 用 `i18n` 包裹需要翻译的文本
```js
// 被翻译的文本
const text = i18n('你好世界')
```
### 模块化引入的形式
跟挂载全局对象的唯一区别就是每个模块都需要单独引入，其他使用并无差别
```js
import { setI18N, i18n } from 'i18n-pro'
// 就是每个模块都需上面这样引入

// 被翻译的文本变量
const text = i18n('你好世界')
```
## 3. 初始化命令行配置文件
在命令行终端输入如下命令
```bash
npx i18n init
```
然后会在当前目录下生成一个 `i18nrc.js` 的文件
## 4. 调整 `i18nrc.js` 配置
根据需求自行调整配置文件中的配置项，配置项的[说明](#命令行)
## 5. 执行翻译命令
```bash
npx i18n t
```
命令执行成功的话，会在指定的目录下生成语言包文件
## 6. 引入语言包文件
语言包已经有了，就需要应用到项目中了

如果生成的语言包是每个语言单独文件形式，操作如下：
```js
import en from './i18n/en.json'
import jp from './i18n/jp.json'
// .. 其他更多语言

setI18N({
  locale: 'en',
  langs:{
    en,
    jp,
    // ...其他更多语言
  },
})
// 后续是应用页面渲染逻辑
```
如果生成的语言包是聚合的形式，操作如下：
```js
import langs from './i18n/langs.json'

setI18N({
  locale: 'en',
  langs,
})
// 后续是应用页面渲染逻辑
```
至此，项目已经完全接入了国际化，上面 `locale` 指定为目标语言中任意一个，在页面上就能看到翻译好的内容了。后续如果项目中有新增的翻译文本，就仅仅需要再次执行翻译命令 `npx i18n t` 生成最新的语言包就可以了
## 7. 切换语言
正常情况下，执行如下方法就行，但是页面上已渲染的内容不会再更新，只有等对应文本的 `i18n` 函数重新执行，才会显示新语言对应的文本
```js
setI18N({
  locale: 'en', // 设置指定语言
})
```
尽管有的前端库（例如 `react`）可以利用它的 `context` 特性做到静态更新页面内容，但是对于不在组件内部的翻译文本内容，要做到静态更新也会有额外的处理成本，例如下面的这种场景，组件内使用了外部包含翻译内容的属性
```js
// 这个属性要做到静态更新，需要额外处理
// 这里只是说明存在这种情况，不给出明确解决方案
const FOO_TEXT = i18n('静态文本属性')

function App(){
  return (
    <>
      {FOO_TEXT}
    </>
  )
}

```
因此对于大部分的场景，在页面上切换语言时，建议**直接刷新**整个页面（如果还有好的方案请告知🤔）
# 命令行
## 1. `i18nrc.js` 配置
### 基础配置
| 名称        |            类型             | 是否必设 |   默认值    | 说明                                                                                                                 |
| ----------- | :-------------------------: | :------: | :---------: | -------------------------------------------------------------------------------------------------------------------- |
| funcName    |           string            |    否    |    i18n     | 命令行匹配翻译文本的函数名<br/><br/>如果在使用 `i18n` 函数没有重命名，这里不需要调整，否则这里配置为重命名后的函数名 |
| entry       |           string            |    是    |      -      | 指定翻译文件目录（绝对路径）                                                                                         |
| fileRegExp  |           RegExp            |    否    | `/.[jt]s$/` | 匹配文件名的正则表达式<br/><br/>用于筛选需要被翻译的文件                                                             |
| output      |      [Output](#output)      |    是    |      -      | 输出文件相关的配置                                                                                                   |
| baiduConfig | [BaiduConfig](#baiduconfig) |    是    |      -      | 百度翻译相关的配置                                                                                                   |
### Output
输出文件的配置
| 名称     |          类型          | 是否必设 |  默认值  | 说明                                                                                                                                                                                                                                                                                                                         |
| -------- | :--------------------: | :------: | :------: | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| path     |         string         |    是    |    -     | 语言包生成的目录（绝对路径）                                                                                                                                                                                                                                                                                                 |
| langType | 'single' \| 'multiple' |    否    | 'single' | 输出语言包文件的形式<br/><br/>假设目标语言是 `['en', 'jp']`<br/>**single** 只会生成一个聚合的语言包文件 `langs.json`，格式如下：<br/> `{ "en":{ "xxx":"xxx" }, "jp":{ "xxx":"xxx" } }` <br/><br/> **multiple** 每个目标语言都会生成对应的语言包文件，对应两个文件：`en.json`， `jp.json` ，格式如下：<br/> `{ "xxx":"xxx" }` |
### BaiduConfig
百度翻译的配置
| 名称          |         类型          | 是否必设 | 默认值 | 说明                                                                                                                                                                                                                                                         |
| ------------- | :-------------------: | :------: | :----: | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| appid         |        string         |    是    |   -    | APPID，需要[注册账号](http://api.fanyi.baidu.com/doc/21 '文档中有指导说明')申请                                                                                                                                                                              |
| key           |        string         |    是    |   -    | 密钥，要求同上                                                                                                                                                                                                                                               |
| from          |        string         |    是    |   -    | 被翻译文本的语言代码（例如中文的是 `zh`，英语的是 `en`），[更多语言](http://api.fanyi.baidu.com/doc/21 '搜索"语种列表"')，搜索**语种列表**                                                                                                                   |
| to            |       string[]        |    是    |   -    | 翻译的目标语言代码，格式同上<br/><br/>📢📢📢：如果目标语言配置为 `['en']`，那么生成的文件名（`output.langType=='multiple'`时）就是 `en.json`，设置语言时的 `locale` 也必须是 `'en'`，如果需要 `locale` 设置为 `'en_US'` 这种，就需要配合 `codeLocaleMap` 来使用 |
| codeLocaleMap | Record<string,string> |    否    |   {}   | 设置语言的代码与 `locale` 的映射关系<br/><br/>例如目标语言为 `['en']`，想设置 `locale` 的组值为 `'en_US'`，那么需要配置 `codeLocaleMap` 为 `{ 'en' : 'en_US' }`，最终生成的文件名（`output.langType=='multiple'`时）也会变成 `en_US.json`                    |
## 2. 命令
